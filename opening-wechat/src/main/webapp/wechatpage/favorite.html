<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>我的收藏</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <style type="text/css">
        .mui-bottom {
            position: absolute;
            bottom: 0;
            width: 100%;
        }

        .red {
            color: red;
        }

        .green {
            color: green;
        }

        .mui-bar .mui-title {
            left: 0;
            right: 0;
        }

        .mui-badge {
            font-size: 16px;
            padding: 8px 16px;
        }

        #refreshContainer {
            position: fixed;
            top: 44px;
            bottom: 50px;
            width: 100%;
        }

        .mui-input-row div {
            font-family: 'Helvetica Neue', Helvetica, sans-serif;
            line-height: 1.1;
            padding: 11px 15px;
        }

        .mui-input-row:not(.mui-radio) label {
            width: 40%;
        }

        .mui-popup {
            width: 300px;
        }
    </style>
</head>

<body>
<header class="mui-bar mui-bar-nav">
    <h1 class="mui-title"><span class="mui-icon mui-icon-chatboxes"></span>距离选房开始还有：<span class="red" id="time">0天0小时0分0秒</span></h1>
</header>
<div class="mui-content">
    <!--下拉刷新容器-->
    <div id="refreshContainer" class="mui-content mui-scroll-wrapper">
        <div class="mui-scroll">
            <!--数据列表-->
            <ul class="mui-table-view mui-table-view-chevron">
            </ul>
        </div>
    </div>
</div>
<nav class="mui-bar mui-bar-tab">
    <a class="mui-tab-item" href="house.html">
        <span class="mui-icon mui-icon-home"></span>
        <span class="mui-tab-label">房源</span>
    </a>
    <a class="mui-tab-item mui-active" href="favorite.html">
        <span class="mui-icon mui-icon-email"></span>
        <span class="mui-tab-label">收藏</span>
    </a>
    <a class="mui-tab-item" href="me.html">
        <span class="mui-icon mui-icon-person"></span>
        <span class="mui-tab-label">我的</span>
    </a>
</nav>
<script src="js/mui.min.js"></script>
<script src="js/moment.min.js"></script>
<script src="js/app.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
    mui.init({
        pullRefresh: {
            container: "#refreshContainer", //下拉刷新容器标识，querySelector能定位的css选择器均可，比如：id、.class等
            down: {
                style: 'circle', //必选，下拉刷新样式，目前支持原生5+ ‘circle’ 样式
                color: '#2BD009', //可选，默认“#2BD009” 下拉刷新控件颜色
                height: '50px', //可选,默认50px.下拉刷新控件的高度,
                range: '100px', //可选 默认100px,控件可下拉拖拽的范围
                offset: '0px', //可选 默认0px,下拉刷新控件的起始位置
                auto: false, //可选,默认false.首次加载自动上拉刷新一次
                callback: function () { //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；

                }
            },
            up: {
                height: 50, //可选.默认50.触发上拉加载拖动距离
                auto: false, //可选,默认false.自动上拉加载一次
                contentrefresh: "正在加载...", //可选，正在加载状态时，上拉加载控件上显示的标题内容
                contentnomore: '没有更多数据了', //可选，请求完毕若没有更多数据时显示的提醒内容；
                callback: function () { //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；

                }
            }
        }
    })
    // 获取开始时间
    var timmer;
    ajax('/rest/system/get/START_TIME', {
        type: 'GET',
        success: function (time) {
            setTime(time)
        }
    })

    function setTime(time) {
        var now = new Date().getTime()
        if (now >= time) {
            timmer && clearInterval(timmer)
            mui('#time')[0].innerText = '本次选房已开始...'
            return
        }
        var d = moment(time).diff(now, 'days')
        if (d > 10) {
            mui('#time')[0].innerText = moment(time).format('MM月DD号 HH:mm:ss开始')
            return
        }
        var h = moment(time).diff(now, 'hours') - d * 24
        var m = moment(time).diff(now, 'minutes') - d * 24 * 60 - h * 60
        var s = moment(time).diff(now, 'seconds') - d * 24 * 60 * 60 - h * 60 * 60 - m * 60
        mui('#time')[0].innerText = d + '天' + h + '小时' + m + '分' + s + '秒'
        if (!timmer) {
            timmer = setInterval(function () {
                setTime(time)
            }, 1000)
        }
    }

    goUrl('.mui-bar .mui-tab-item', function (that) {
        return that.getAttribute('href')
    })
    // 获取我的收藏
    ajax('/rest/house/getFavorite', {
        type: 'GET',
        success: function (list) {
            var html = ''
            if (!list || list.length < 1) {
                html += '<li class="mui-table-view-cell mui-text-center">暂无收藏</li>'
            } else {
                list.forEach(function (item) {
                    html += '<li class="mui-table-view-cell">' +
                        '                        <a class="mui-row">' +
                        '                            <div class="mui-col-xs-6 mui-col-sm-6">房号：' + item.roomNo + '</div>' +
                        '                            <div class="mui-col-xs-6 mui-col-sm-6">状态：<span class="' + (['green', 'red', ''][item.status]) + '">' + ['未售', '已售', '未推'][item.status] + '</span></div>' +
                        '                            <div class="mui-col-xs-6 mui-col-sm-6">面积：' + item.area + '㎡</div>' +
                        '                            <div class="mui-col-xs-6 mui-col-sm-6">单价：' + item.unitPrice + '元</div>' +
                        '                            <div class="mui-col-xs-6 mui-col-sm-6">总价：' + (item.totalPrice / 10000) + '万</div>' +
                        '                            <div class="mui-col-xs-6 mui-col-sm-6">户型：三室两厅</div>' +
                        '                            <div class="mui-col-xs-6 mui-col-sm-6">收藏数：' + item.count + '</div>' +
                        '                        </a>' +
                        '                        <span class="mui-badge ' + (item.status === 0 ? 'mui-badge-primary' : '') + '" status="' + item.status + '">认购</span>' +
                        '                    </li>'
                })
            }
            mui('.mui-table-view')[0].innerHTML = html
        }
    })

    mui('.mui-table-view-cell').on('tap', '.mui-badge-primary', function () {
        mui.confirm('<div class="mui-text-left">\
								<div class="mui-input-row">\
									<label>房号：</label>\
									<div>1号楼1-101 </div>\
								</div>\
								<div class="mui-input-row">\
									<label>户型图：</label>\
									<div>户型 </div>\
								</div>\
								<div class="mui-input-row">\
									<label>户型：</label>\
									<div>三室两厅 </div>\
								</div>\
								<div class="mui-input-row">\
									<label>状态：</label>\
									<div>未售 </div>\
								</div>\
								<div class="mui-input-row">\
									<label>单价：</label>\
									<div>1万元 </div>\
								</div>\
								<div class="mui-input-row">\
									<label>面积：</label>\
									<div>100㎡ </div>\
								</div>\
								<div class="mui-input-row">\
									<label>总价：</label>\
									<div>100万 </div>\
								</div>\
								<div class="mui-input-row">\
									<label>总价：</label>\
									<div>100万 </div>\
								</div>\
								<div class="mui-input-row mui-radio mui-left">\
									<label for="agreement">本人已阅读并同意<a href="agreement.html" id="agreementHtml">微信选房协议</a></label>\
									<input name="agreement" id="agreement" type="radio">\
								</div> \
							</div>', '房产信息', ['取消认购', '确认认购'],
            function (e) {
                mui.alert('<div class="mui-text-left">\
									<div class="mui-input-row">\
										<label>客户名称：</label>\
										<div>申何健 </div>\
									</div>\
									<div class="mui-input-row">\
										<label>认筹号：</label>\
										<div>17683701650</div>\
									</div>\
									<div class="mui-input-row">\
										<label>成交单位：</label>\
										<div>一号楼1-101</div>\
									</div>\
									<div class="mui-input-row">\
										<label>销控时间：</label>\
										<div>2018-03-01 12:23:59</div>\
									</div>\
								</div>', '提示', '确定',
                    function (e) {
                        location.href = 'me.html'
                    }, 'div')
            }, 'div')
        goUrl('#agreementHtml', 'agreement.html')
    })
</script>
</body>

</html>